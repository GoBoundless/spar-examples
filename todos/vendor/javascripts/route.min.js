(function(){var f,i,j,h,k,l=Object.prototype.hasOwnProperty,m=function(d,b){function e(){this.constructor=d}for(var a in b)l.call(b,a)&&(d[a]=b[a]);e.prototype=b.prototype;d.prototype=new e;d.__super__=b.prototype;return d},n=Array.prototype.slice;if("undefined"===typeof Spine||null===Spine)Spine=require("spine");f=Spine.$;j=/^#*/;h=/:([\w\d]+)/g;k=/\*([\w\d]+)/g;i=/[-[\]{}()+?.,\\^$|#\s]/g;Spine.Route=function(d){function b(a,b){var c;this.path=a;this.callback=b;this.names=[];if("string"===typeof a){for(h.lastIndex=
0;null!==(c=h.exec(a));)this.names.push(c[1]);a=a.replace(i,"\\$&").replace(h,"([^/]*)").replace(k,"(.*?)");this.route=RegExp("^"+a+"$")}else this.route=a}var e;m(b,d);b.extend(Spine.Events);b.historySupport=null!=(null!=(e=window.history)?e.pushState:void 0);b.routes=[];b.options={trigger:!0,history:!1,shim:!1};b.add=function(a,b){var c,d,g;if("object"===typeof a&&!(a instanceof RegExp)){g=[];for(c in a)d=a[c],g.push(this.add(c,d));return g}return this.routes.push(new this(a,b))};b.setup=function(a){null==
a&&(a={});this.options=f.extend({},this.options,a);this.options.history&&(this.history=this.historySupport&&this.options.history);if(!this.options.shim)return this.history?f(window).bind("popstate",this.change):f(window).bind("hashchange",this.change),this.change()};b.unbind=function(){return this.history?f(window).unbind("popstate",this.change):f(window).unbind("hashchange",this.change)};b.navigate=function(){var a,b,c;a=1<=arguments.length?n.call(arguments,0):[];c={};b=a[a.length-1];"object"===
typeof b?c=a.pop():"boolean"===typeof b&&(c.trigger=a.pop());c=f.extend({},this.options,c);a=a.join("/");if(this.path!==a&&(this.path=a,this.trigger("navigate",this.path),c.trigger&&this.matchRoute(this.path,c),!c.shim))return this.history?history.pushState({},document.title,this.path):window.location.hash=this.path};b.getPath=function(){var a;a=window.location.pathname;"/"!==a.substr(0,1)&&(a="/"+a);return a};b.getHash=function(){return window.location.hash};b.getFragment=function(){return this.getHash().replace(j,
"")};b.getHost=function(){return(document.location+"").replace(this.getPath()+this.getHash(),"")};b.change=function(){var a;a=""!==this.getFragment()?this.getFragment():this.getPath();if(a!==this.path)return this.path=a,this.matchRoute(this.path)};b.matchRoute=function(a,b){var c,d,g,e;e=this.routes;d=0;for(g=e.length;d<g;d++)if(c=e[d],c.match(a,b))return this.trigger("change",c,a),c};b.prototype.match=function(a,b){var c,d,e,f;null==b&&(b={});c=this.route.exec(a);if(!c)return!1;b.match=c;e=c.slice(1);
if(this.names.length){c=0;for(f=e.length;c<f;c++)d=e[c],b[this.names[c]]=d}return!1!==this.callback.call(null,b)};return b}(Spine.Module);Spine.Route.change=Spine.Route.proxy(Spine.Route.change);Spine.Controller.include({route:function(d,b){return Spine.Route.add(d,this.proxy(b))},routes:function(d){var b,e,a;a=[];for(b in d)e=d[b],a.push(this.route(b,e));return a},navigate:function(){return Spine.Route.navigate.apply(Spine.Route,arguments)}});"undefined"!==typeof module&&null!==module&&(module.exports=
Spine.Route)}).call(this);
